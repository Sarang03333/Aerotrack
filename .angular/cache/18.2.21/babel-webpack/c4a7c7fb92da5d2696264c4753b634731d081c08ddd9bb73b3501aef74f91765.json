{"ast":null,"code":"import { BehaviorSubject } from 'rxjs';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/common/http\";\nconst STORAGE_KEY = 'aerotrack.audit';\nexport let AuditService = /*#__PURE__*/(() => {\n  class AuditService {\n    constructor(http) {\n      this.http = http;\n      this._logs$ = new BehaviorSubject([]);\n      this.initialize();\n    }\n    initialize() {\n      const cached = localStorage.getItem(STORAGE_KEY);\n      if (cached) {\n        try {\n          this._logs$.next(JSON.parse(cached));\n          return;\n        } catch {}\n      }\n      this.http.get('assets/mock/audit.json').subscribe({\n        next: d => {\n          this._logs$.next(d);\n          this.persist();\n        },\n        error: () => {\n          const fallback = [{\n            auditID: 'AU-9001',\n            aircraftID: 'AT-1001',\n            findings: 'Initial safety check - minor issue in landing lights',\n            date: new Date().toISOString().slice(0, 10)\n          }];\n          this._logs$.next(fallback);\n          this.persist();\n        }\n      });\n    }\n    persist() {\n      throw new Error('Method not implemented.');\n    }\n    list() {\n      return this._logs$.asObservable();\n    }\n    getValue() {\n      return this._logs$.getValue();\n    }\n    getById(id) {\n      return this.getValue().find(x => x.auditID === id);\n    }\n    add(log) {\n      const arr = this.getValue();\n      if (arr.some(x => x.auditID === log.auditID)) throw new Error('AuditID must be unique');\n      this._logs$.next([...arr, log]);\n      this.persist();\n    }\n    update(id, changes) {\n      this._logs$.next(this.getValue().map(x => x.auditID === id ? {\n        ...x,\n        ...changes\n      } : x));\n      this.persist();\n    }\n    remove(id) {\n      this._logs$.next(this.getValue().filter(x => x.auditID !== id));\n      this.persist();\n    }\n    markCorrectiveAction(id) {\n      // For demo, append a note to findings\n      const updated = this.getValue().map(x => x.auditID === id ? {\n        ...x,\n        findings: x.findings + ' | Corrective action: RESOLVED'\n      } : x);\n      this._logs$.next(updated);\n      this.persist();\n    }\n    exportComplianceCSV() {\n      const rows = [['AuditID', 'AircraftID', 'Findings', 'Date']];\n      for (const x of this.getValue()) {\n        // Replace newlines in findings with a space so the CSV stays one line per row\n        const safeFindings = x.findings.replace(/\\n/g, ' ');\n        rows.push([x.auditID, x.aircraftID, safeFindings, x.date]);\n      }\n      // Escape double quotes and join rows by newline\n      const csv = rows.map(r => r.map(c => `\"${String(c).replace(/\"/g, '\"\"')}\"`).join(',')).join('\\n');\n      return new Blob([csv], {\n        type: 'text/csv;charset=utf-8;'\n      });\n    }\n    static {\n      this.ɵfac = function AuditService_Factory(__ngFactoryType__) {\n        return new (__ngFactoryType__ || AuditService)(i0.ɵɵinject(i1.HttpClient));\n      };\n    }\n    static {\n      this.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n        token: AuditService,\n        factory: AuditService.ɵfac,\n        providedIn: 'root'\n      });\n    }\n  }\n  return AuditService;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}