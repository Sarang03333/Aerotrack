{"ast":null,"code":"import { CommonModule } from '@angular/common';\nimport Chart from 'chart.js/auto';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"../../../core/services/maintenance.service\";\nimport * as i2 from \"../../../core/services/aircraft.service\";\nimport * as i3 from \"../../../core/services/spares.service\";\nimport * as i4 from \"../../../core/services/audit.service\";\nimport * as i5 from \"../../../core/services/reports.service\";\nimport * as i6 from \"@angular/common\";\nconst _c0 = [\"maintBar\"];\nconst _c1 = [\"maintDonut\"];\nconst _c2 = [\"maintLine\"];\nconst _c3 = [\"aircatBar\"];\nconst _c4 = [\"compDonut\"];\nconst _c5 = [\"sparesDonut\"];\nexport let DashboardsPageComponent = /*#__PURE__*/(() => {\n  class DashboardsPageComponent {\n    constructor(maintenanceSvc, aircraftSvc, sparesSvc, auditSvc, reports) {\n      this.maintenanceSvc = maintenanceSvc;\n      this.aircraftSvc = aircraftSvc;\n      this.sparesSvc = sparesSvc;\n      this.auditSvc = auditSvc;\n      this.reports = reports;\n      // KPI cards\n      this.kpi = this.reports.generate();\n      this.subs = [];\n    }\n    ngAfterViewInit() {\n      // Initialize charts once canvases are available\n      this.initMaintenanceCharts();\n      this.initAdminCharts();\n      // Reactive updates from services\n      this.subs.push(this.maintenanceSvc.list().subscribe(tasks => {\n        const pending = tasks.filter(t => t.status === 'PENDING').length;\n        const inprog = tasks.filter(t => t.status === 'IN_PROGRESS').length;\n        const done = tasks.filter(t => t.status === 'COMPLETED').length;\n        // Maintenance status bar\n        this.maintBarChart.data.labels = ['Pending', 'In Progress', 'Completed'];\n        this.maintBarChart.data.datasets[0].data = [pending, inprog, done];\n        this.maintBarChart.update();\n        // Maintenance status doughnut\n        this.maintDonutChart.data.labels = ['Pending', 'In Progress', 'Completed'];\n        this.maintDonutChart.data.datasets[0].data = [pending, inprog, done];\n        this.maintDonutChart.update();\n        // Maintenance trend line (by scheduledDate)\n        const perDay = new Map();\n        tasks.forEach(t => {\n          const d = (t.scheduledDate || '').slice(0, 10);\n          perDay.set(d, (perDay.get(d) || 0) + 1);\n        });\n        const labels = Array.from(perDay.keys()).sort();\n        this.maintLineChart.data.labels = labels;\n        this.maintLineChart.data.datasets[0].data = labels.map(l => perDay.get(l) || 0);\n        this.maintLineChart.update();\n        // KPIs recompute\n        this.kpi = this.reports.generate();\n      }));\n      this.subs.push(this.aircraftSvc.list().subscribe(list => {\n        const commercial = list.filter(a => a.category === 'Commercial').length;\n        const defense = list.filter(a => a.category === 'Defense').length;\n        const cargo = list.filter(a => a.category === 'Cargo').length;\n        // Aircraft category bar\n        this.aircatBarChart.data.labels = ['Commercial', 'Defense', 'Cargo'];\n        this.aircatBarChart.data.datasets[0].data = [commercial, defense, cargo];\n        this.aircatBarChart.update();\n        const compliant = list.filter(a => a.complianceStatus === 'Compliant').length;\n        const pendingComp = list.filter(a => a.complianceStatus === 'Pending').length;\n        const nonCompliant = list.filter(a => a.complianceStatus === 'Non-Compliant').length;\n        // Compliance doughnut\n        this.compDonutChart.data.labels = ['Compliant', 'Pending', 'Non-Compliant'];\n        this.compDonutChart.data.datasets[0].data = [compliant, pendingComp, nonCompliant];\n        this.compDonutChart.update();\n      }));\n      this.subs.push(this.sparesSvc.list().subscribe(parts => {\n        const low = parts.filter(p => p.quantityAvailable <= p.reorderLevel).length;\n        const ok = parts.length - low;\n        // Spares health doughnut\n        this.sparesDonutChart.data.labels = ['LOW', 'OK'];\n        this.sparesDonutChart.data.datasets[0].data = [low, ok];\n        this.sparesDonutChart.update();\n      }));\n    }\n    initMaintenanceCharts() {\n      // Status bar\n      this.maintBarChart = new Chart(this.maintBar.nativeElement, {\n        type: 'bar',\n        data: {\n          labels: [],\n          datasets: [{\n            label: 'Tasks',\n            data: [],\n            backgroundColor: ['#ffc107', '#fd7e14', '#198754']\n          }]\n        },\n        options: {\n          responsive: true,\n          plugins: {\n            legend: {\n              display: true\n            }\n          }\n        }\n      });\n      // Status doughnut\n      this.maintDonutChart = new Chart(this.maintDonut.nativeElement, {\n        type: 'doughnut',\n        data: {\n          labels: [],\n          datasets: [{\n            data: [],\n            backgroundColor: ['#ffe38a', '#feb27c', '#74c69d'],\n            borderColor: ['#ffc107', '#fd7e14', '#198754']\n          }]\n        },\n        options: {\n          responsive: true,\n          plugins: {\n            legend: {\n              position: 'bottom'\n            }\n          }\n        }\n      });\n      // Trend line\n      this.maintLineChart = new Chart(this.maintLine.nativeElement, {\n        type: 'line',\n        data: {\n          labels: [],\n          datasets: [{\n            label: 'Tasks per Day',\n            data: [],\n            borderColor: '#0b5ed7',\n            backgroundColor: 'rgba(11,94,215,0.2)',\n            tension: 0.2,\n            fill: true\n          }]\n        },\n        options: {\n          responsive: true,\n          scales: {\n            y: {\n              beginAtZero: true\n            }\n          },\n          plugins: {\n            legend: {\n              display: true\n            }\n          }\n        }\n      });\n    }\n    initAdminCharts() {\n      // Aircraft category bar\n      this.aircatBarChart = new Chart(this.aircatBar.nativeElement, {\n        type: 'bar',\n        data: {\n          labels: [],\n          datasets: [{\n            label: 'Aircraft',\n            data: [],\n            backgroundColor: ['#0b5ed7', '#6f42c1', '#20c997']\n          }]\n        },\n        options: {\n          responsive: true,\n          plugins: {\n            legend: {\n              display: false\n            }\n          }\n        }\n      });\n      // Compliance doughnut\n      this.compDonutChart = new Chart(this.compDonut.nativeElement, {\n        type: 'doughnut',\n        data: {\n          labels: [],\n          datasets: [{\n            data: [],\n            backgroundColor: ['#198754', '#ffc107', '#dc3545'],\n            borderColor: ['#198754', '#ffc107', '#dc3545']\n          }]\n        },\n        options: {\n          responsive: true,\n          plugins: {\n            legend: {\n              position: 'bottom'\n            }\n          }\n        }\n      });\n      // Spares health doughnut\n      this.sparesDonutChart = new Chart(this.sparesDonut.nativeElement, {\n        type: 'doughnut',\n        data: {\n          labels: [],\n          datasets: [{\n            data: [],\n            backgroundColor: ['#dc3545', '#198754'],\n            borderColor: ['#dc3545', '#198754']\n          }]\n        },\n        options: {\n          responsive: true,\n          plugins: {\n            legend: {\n              position: 'bottom'\n            }\n          }\n        }\n      });\n    }\n    ngOnDestroy() {\n      this.subs.forEach(s => s.unsubscribe());\n      // Destroy charts to free canvas/webgl contexts (optional but good hygiene)\n      this.maintBarChart?.destroy();\n      this.maintDonutChart?.destroy();\n      this.maintLineChart?.destroy();\n      this.aircatBarChart?.destroy();\n      this.compDonutChart?.destroy();\n      this.sparesDonutChart?.destroy();\n    }\n    static {\n      this.ɵfac = function DashboardsPageComponent_Factory(__ngFactoryType__) {\n        return new (__ngFactoryType__ || DashboardsPageComponent)(i0.ɵɵdirectiveInject(i1.MaintenanceService), i0.ɵɵdirectiveInject(i2.AircraftService), i0.ɵɵdirectiveInject(i3.SparesService), i0.ɵɵdirectiveInject(i4.AuditService), i0.ɵɵdirectiveInject(i5.ReportsService));\n      };\n    }\n    static {\n      this.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n        type: DashboardsPageComponent,\n        selectors: [[\"app-dashboards-page\"]],\n        viewQuery: function DashboardsPageComponent_Query(rf, ctx) {\n          if (rf & 1) {\n            i0.ɵɵviewQuery(_c0, 5);\n            i0.ɵɵviewQuery(_c1, 5);\n            i0.ɵɵviewQuery(_c2, 5);\n            i0.ɵɵviewQuery(_c3, 5);\n            i0.ɵɵviewQuery(_c4, 5);\n            i0.ɵɵviewQuery(_c5, 5);\n          }\n          if (rf & 2) {\n            let _t;\n            i0.ɵɵqueryRefresh(_t = i0.ɵɵloadQuery()) && (ctx.maintBar = _t.first);\n            i0.ɵɵqueryRefresh(_t = i0.ɵɵloadQuery()) && (ctx.maintDonut = _t.first);\n            i0.ɵɵqueryRefresh(_t = i0.ɵɵloadQuery()) && (ctx.maintLine = _t.first);\n            i0.ɵɵqueryRefresh(_t = i0.ɵɵloadQuery()) && (ctx.aircatBar = _t.first);\n            i0.ɵɵqueryRefresh(_t = i0.ɵɵloadQuery()) && (ctx.compDonut = _t.first);\n            i0.ɵɵqueryRefresh(_t = i0.ɵɵloadQuery()) && (ctx.sparesDonut = _t.first);\n          }\n        },\n        standalone: true,\n        features: [i0.ɵɵStandaloneFeature],\n        decls: 73,\n        vars: 7,\n        consts: [[\"maintBar\", \"\"], [\"maintDonut\", \"\"], [\"maintLine\", \"\"], [\"aircatBar\", \"\"], [\"compDonut\", \"\"], [\"sparesDonut\", \"\"], [1, \"card\"], [2, \"margin-top\", \"0\"], [2, \"color\", \"#6c757d\", \"margin-bottom\", \"1rem\"], [1, \"grid\", 2, \"grid-template-columns\", \"repeat(12, 1fr)\", \"gap\", \"1rem\"], [1, \"col-6\"], [1, \"col-12\"], [2, \"margin-top\", \"2rem\"], [1, \"kpi-cards\"], [1, \"kpi\"], [1, \"val\"]],\n        template: function DashboardsPageComponent_Template(rf, ctx) {\n          if (rf & 1) {\n            i0.ɵɵelementStart(0, \"div\", 6)(1, \"h2\", 7);\n            i0.ɵɵtext(2, \"Dashboards\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(3, \"p\", 8);\n            i0.ɵɵtext(4, \" All dashboards on a single page, powered by Chart.js (no wrappers). \");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(5, \"h3\");\n            i0.ɵɵtext(6, \"Maintenance\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(7, \"div\", 9)(8, \"div\", 10)(9, \"div\", 6)(10, \"h4\");\n            i0.ɵɵtext(11, \"Status (Bar)\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelement(12, \"canvas\", null, 0);\n            i0.ɵɵelementEnd()();\n            i0.ɵɵelementStart(14, \"div\", 10)(15, \"div\", 6)(16, \"h4\");\n            i0.ɵɵtext(17, \"Status (Doughnut)\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelement(18, \"canvas\", null, 1);\n            i0.ɵɵelementEnd()();\n            i0.ɵɵelementStart(20, \"div\", 11)(21, \"div\", 6)(22, \"h4\");\n            i0.ɵɵtext(23, \"Trend (Tasks per Day)\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelement(24, \"canvas\", null, 2);\n            i0.ɵɵelementEnd()()();\n            i0.ɵɵelementStart(26, \"h3\", 12);\n            i0.ɵɵtext(27, \"Admin\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(28, \"div\", 9)(29, \"div\", 10)(30, \"div\", 6)(31, \"h4\");\n            i0.ɵɵtext(32, \"Aircraft by Category\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelement(33, \"canvas\", null, 3);\n            i0.ɵɵelementEnd()();\n            i0.ɵɵelementStart(35, \"div\", 10)(36, \"div\", 6)(37, \"h4\");\n            i0.ɵɵtext(38, \"Compliance Status\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelement(39, \"canvas\", null, 4);\n            i0.ɵɵelementEnd()();\n            i0.ɵɵelementStart(41, \"div\", 10)(42, \"div\", 6)(43, \"h4\");\n            i0.ɵɵtext(44, \"Inventory Health (Spares)\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelement(45, \"canvas\", null, 5);\n            i0.ɵɵelementEnd()();\n            i0.ɵɵelementStart(47, \"div\", 10)(48, \"div\", 6)(49, \"h4\");\n            i0.ɵɵtext(50, \"Fleet KPIs (Mock)\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(51, \"div\", 13)(52, \"div\", 14)(53, \"div\");\n            i0.ɵɵtext(54, \"Maintenance Cost\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(55, \"div\", 15);\n            i0.ɵɵtext(56);\n            i0.ɵɵpipe(57, \"number\");\n            i0.ɵɵelementEnd()();\n            i0.ɵɵelementStart(58, \"div\", 14)(59, \"div\");\n            i0.ɵɵtext(60, \"Safety Performance\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(61, \"div\", 15);\n            i0.ɵɵtext(62);\n            i0.ɵɵelementEnd()();\n            i0.ɵɵelementStart(63, \"div\", 14)(64, \"div\");\n            i0.ɵɵtext(65, \"Downtime (hrs)\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(66, \"div\", 15);\n            i0.ɵɵtext(67);\n            i0.ɵɵelementEnd()();\n            i0.ɵɵelementStart(68, \"div\", 14)(69, \"div\");\n            i0.ɵɵtext(70, \"Generated\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(71, \"div\", 15);\n            i0.ɵɵtext(72);\n            i0.ɵɵelementEnd()()()()()()();\n          }\n          if (rf & 2) {\n            i0.ɵɵadvance(56);\n            i0.ɵɵtextInterpolate1(\"\\u20B9 \", i0.ɵɵpipeBind2(57, 4, ctx.kpi.metrics.costAnalysis, \"1.0-0\"), \"\");\n            i0.ɵɵadvance(6);\n            i0.ɵɵtextInterpolate1(\"\", ctx.kpi.metrics.safetyPerformance, \" / 100\");\n            i0.ɵɵadvance(5);\n            i0.ɵɵtextInterpolate(ctx.kpi.metrics.downtimeHours);\n            i0.ɵɵadvance(5);\n            i0.ɵɵtextInterpolate(ctx.kpi.generatedDate);\n          }\n        },\n        dependencies: [CommonModule, i6.DecimalPipe],\n        styles: [\".kpi-cards[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(2,minmax(180px,1fr));gap:1rem}.kpi[_ngcontent-%COMP%]{padding:1rem;border-radius:12px;background:#fff;border:1px solid #e3e6ea}.kpi[_ngcontent-%COMP%]   .val[_ngcontent-%COMP%]{font-size:1.3rem;font-weight:700}\"]\n      });\n    }\n  }\n  return DashboardsPageComponent;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}